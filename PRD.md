üìÑ Product Requirements Document (PRD)Nom du Projet : Wouri Bot - Assistant WhatsApp RAG & VocalDate : 12 D√©cembre 2025Version : 1.0 (MVP)Stack Cible : FastAPI, Supabase, OpenAI, Paystack1. R√©sum√© Ex√©cutif (Executive Summary)Le projet consiste √† d√©velopper un agent conversationnel intelligent sur WhatsApp capable de comprendre et de r√©pondre en texte et en notes vocales. L'agent utilise le RAG (Retrieval Augmented Generation) pour fournir des r√©ponses pr√©cises bas√©es sur une base de connaissances priv√©e.Le mod√®le √©conomique est un Freemium : l'utilisateur dispose d'un quota d'essai gratuit, puis doit souscrire √† un abonnement mensuel via Mobile Money (Paystack) pour continuer √† utiliser le service.2. Personas & CibleUtilisateur Cible : Professionnel ou particulier en C√¥te d'Ivoire cherchant des informations pr√©cises sans avoir √† lire de longs documents. Pr√©f√®re l'interaction vocale pour la rapidit√©.Probl√®me r√©solu : Difficult√© d'acc√®s √† l'information technique/sp√©cifique et barri√®re de la lecture sur mobile.3. Fonctionnalit√©s Cl√©s (Functional Requirements)3.1. Gestion des Messages (Core Loop)R√©ception : Le bot doit accepter les messages Textes et les messages Vocaux (Audio).Traitement Audio (STT) : Tout message vocal re√ßu doit √™tre transcrit en texte (Speech-to-Text) via OpenAI Whisper.R√©ponse Adaptative :Si l'entr√©e est Texte ‚Üí La r√©ponse est Texte.Si l'entr√©e est Vocale ‚Üí La r√©ponse est Vocale (Text-to-Speech).Contextualisation : Le bot doit garder une m√©moire de la conversation (historique des 5-10 derniers √©changes) pour permettre un dialogue fluide.3.2. Cerveau & RAG (Retrieval Augmented Generation)Base de Connaissance : Le bot ne doit r√©pondre qu'en se basant sur les documents fournis (PDF, TXT) stock√©s dans la base vectorielle.Hallucination : Si la r√©ponse n'est pas dans les documents, le bot doit r√©pondre : "Je ne trouve pas cette information dans mes documents de r√©f√©rence."3.3. Gestion des Abonnements (Mon√©tisation)Compteur d'essai : Chaque nouvel utilisateur (bas√© sur son wa_id) re√ßoit un quota de X messages gratuits (ex: 5).Le "Gatekeeper" (Vigile) : Avant chaque traitement IA, le syst√®me v√©rifie :L'utilisateur a-t-il un abonnement actif ?Si non, lui reste-t-il des essais gratuits ?Blocage & Paiement : Une fois le quota √©puis√©, le bot bloque la r√©ponse et envoie un message standard : "Votre p√©riode d'essai est termin√©e. Cliquez ici pour vous abonner : [Lien Paystack]".Renouvellement : Gestion automatique du webhook Paystack pour r√©activer l'acc√®s pour 30 jours apr√®s paiement r√©ussi.4. Architecture Technique4.1. Backend & APIFramework : Python FastAPI.H√©bergement : VPS (Ubuntu/Debian) ou Cloud Run.Serveur Web : Uvicorn derri√®re Nginx (si VPS).4.2. Base de Donn√©es (Supabase)Table users :phone_number (Primary Key, String)trial_count (Integer, default 0)subscription_status (Boolean, default False)subscription_end_date (Timestamp, Nullable)Table chat_history : Stockage des messages pour le contexte.Vector Store : pgvector sur Supabase pour stocker les embeddings des documents.4.3. Stack IALLM : OpenAI gpt-4o-mini (pour la rapidit√© et le co√ªt).Transcriptions (STT) : OpenAI whisper-1.Synth√®se Vocale (TTS) : OpenAI tts-1 (Voix : Alloy ou Fable) ou ElevenLabs (si budget permet).Orchestration : LangChain.Observabilit√© : LangSmith (Obligatoire pour le d√©bogage des prompts).4.4. PaiementProvider : Paystack.M√©thodes : Mobile Money (Orange, MTN, Wave, Moov) + Cartes.Flux : Utilisation de l'API "Initialize Transaction" pour g√©n√©rer des liens dynamiques li√©s au num√©ro de t√©l√©phone de l'utilisateur.5. User Stories & Crit√®res d'AcceptationIDUser StoryCrit√®res d'Acceptation (Definition of Done)US-01En tant qu'utilisateur, je veux envoyer une note vocale et recevoir une r√©ponse vocale.1. L'utilisateur envoie un audio < 1min.2. Le bot r√©pond par un audio audible.3. Le temps de r√©ponse est < 15 secondes.US-02En tant qu'utilisateur, je veux que le bot sache qui je suis (m√©moire).1. Si je dis "Je m'appelle Marc", et qu'ensuite je demande "Quel est mon nom ?", il r√©pond "Marc".US-03En tant qu'Admin, je veux que les utilisateurs non-payants soient bloqu√©s apr√®s 5 messages.1. Au 6√®me message, le bot ne r√©pond pas √† la question mais envoie le lien de paiement.US-04En tant qu'utilisateur, je veux payer par Wave/OM et √™tre d√©bloqu√© imm√©diatement.1. Paiement r√©ussi sur Paystack.2. R√©ception d'un message WhatsApp de confirmation ("Abonnement activ√©").3. Le service refonctionne imm√©diatement.6. Contraintes Non-Fonctionnelles (NFR)Latence : Le traitement total pour une r√©ponse texte doit √™tre < 5s. Pour une r√©ponse vocale < 15s.Exp√©rience Utilisateur (WhatsApp) :Le bot doit marquer le message comme "Lu" (Read) d√®s r√©ception.(Optionnel) Le bot doit simuler "En train d'√©crire..." ou "En train d'enregistrer un audio..." pendant le calcul via l'API WhatsApp, pour faire patienter l'utilisateur.S√©curit√© :Le Webhook doit valider la signature X-Hub-Signature de Meta pour √©viter les fausses requ√™tes.Les cl√©s API (OpenAI, Paystack, Meta) doivent √™tre dans un fichier .env, jamais dans le code.7. Roadmap d'Impl√©mentation (Phasing)Phase 1 : Le MVP Technique (Semaine 1)Setup FastAPI + Webhook Meta (Valid√©).Connexion OpenAI (Chat + Whisper).Le bot r√©pond en "Perroquet intelligent" (sans RAG, sans paiement).Phase 2 : Le Cerveau (Semaine 2)Setup Supabase & pgvector.Script d'ingestion des documents (PDF -> Vector DB).Connexion du RAG √† FastAPI.Phase 3 : La Voix & Le Paiement (Semaine 3)Ajout du TTS (Text-to-Speech) et envoi de fichiers .ogg/.mp3 sur WhatsApp.Impl√©mentation du middleware "Gatekeeper" (Gestion des droits).Int√©gration Paystack Webhook.